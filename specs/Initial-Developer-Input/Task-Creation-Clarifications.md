1. The very first decision that the `ah task` command is whether it was executed inside a repo or not.

2. When you are inside a repo, the branch creation always happens in exactly the same way (regardless whether I'm working with a local agent, remote server or a cloud agent). The rationale for creating a local branch is that we are interested in pulling the code that the agent will produce for the task in our local branch, so we can easily make amendments, add follow up tasks, etc.

3. When you are not inside a repo, you have to supply parameters such as `--repo` or `--workspace` (a workspace is a named collection of multiple repos). If you don't supply these, the software obtains a list of repos and workspaces from the remote server or the SQLite database (if a remote server is not supplied) and asks the user to select the repo or the workspace, as well as the target branch which will have a default value (this may be different in each project, but it default to a VCS-specific value like `main` when not specified per project). If the user has supplied the general `--non-interactive` parameter to the `ah` command, `ah task` will exit with a non-zero exit code instead of asking the user to make the choice interactively. Make sure the exit code is specified in the exit codes table. The SQLite database contains the path of each local repo, so choosing a local repo is just like changing the working directory to the right path and proceeding with the execution of `ah task` normally. When you are outside of a repo and you send a task to a remote server, the branch creation is not carried out locally - the server performs it server-side and returns the task identifier you can use for tracking. This enables a mode of work where you launch tasks through the CLI or the WebUI, without ever checking out any source code locally. Similarly, you can do this with the cloud agents by relying on the supplied browser automation.

4. Thus, the browser automation has two modes - with local branch creation and automated delivery of the agent work or without this. When there is no local branch creation, we also cannot create a task file.

5. The creation of task files is controlled by the option `create-task-files` (enabled by default). When this option is disabled, the cloud agent paths always work with the approach described in point 4).

6. Regardless of whether we launch a local or a cloud agent, we supply the same initial prompt (e.g. as a text input box value in the browser automation or as a CLI parameter for a local agent). The prompt can also be inspected by running the `ah agent get-task [--agent agent_kind] [--model model_kind]` command in the task branch (when task file creation is enabled).
